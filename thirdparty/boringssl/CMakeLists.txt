set(BORINGSSL_SSL_DIR ${BORINGSSL_PREFIX_DIR}/${BORINGSSL_EXTERNAL}-build/ssl)
set(BORINGSSL_CRYPTO_DIR
    ${BORINGSSL_PREFIX_DIR}/${BORINGSSL_EXTERNAL}-build/crypto)

ExternalProject_Add(
  ${BORINGSSL_EXTERNAL}
  GIT_REPOSITORY https://github.com/google/boringssl
  GIT_TAG a9670a8b476470e6f874fef3554e8059683e1413
  CMAKE_ARGS -DCMAKE_MODULE_PATH=${CMAKE_MODULE_PATH}
             -DCMAKE_TOOLCHAIN_FILE=${CMAKE_TOOLCHAIN_FILE}
             -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
  BUILD_BYPRODUCTS
    ${BORINGSSL_SSL_DIR}/${CMAKE_STATIC_LIBRARY_PREFIX}ssl${CMAKE_STATIC_LIBRARY_SUFFIX}
    ${BORINGSSL_CRYPTO_DIR}/${CMAKE_STATIC_LIBRARY_PREFIX}crypto${CMAKE_STATIC_LIBRARY_SUFFIX}
  UPDATE_COMMAND ""
  INSTALL_COMMAND "" # Do not build install target
  TEST_COMMAND "" # Do not build test target
)

file(MAKE_DIRECTORY ${BORINGSSL_INCLUDE_DIR})

add_library(boringssl-ssl STATIC IMPORTED GLOBAL)
set_target_properties(
  boringssl-ssl
  PROPERTIES
    IMPORTED_LOCATION
    ${BORINGSSL_SSL_DIR}/${CMAKE_STATIC_LIBRARY_PREFIX}ssl${CMAKE_STATIC_LIBRARY_SUFFIX}
    INTERFACE_INCLUDE_DIRECTORIES ${BORINGSSL_INCLUDE_DIR})
add_dependencies(boringssl-ssl ${BORINGSSL_EXTERNAL})

add_library(boringssl-crypto STATIC IMPORTED GLOBAL)
set_target_properties(
  boringssl-crypto
  PROPERTIES
    IMPORTED_LOCATION
    ${BORINGSSL_CRYPTO_DIR}/${CMAKE_STATIC_LIBRARY_PREFIX}crypto${CMAKE_STATIC_LIBRARY_SUFFIX}
    INTERFACE_INCLUDE_DIRECTORIES ${BORINGSSL_INCLUDE_DIR})
add_dependencies(boringssl-crypto ${BORINGSSL_EXTERNAL})
